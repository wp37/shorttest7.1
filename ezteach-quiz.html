<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ezteach Quiz - Unit 7: Traffic</title>
    <meta name="description" content="B√†i ki·ªÉm tra tr·∫Øc nghi·ªám Unit 7: Traffic - Global Success 7 | Ezteach">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"
        rel="stylesheet">

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'ezteach': {
                            50: '#eef2ff',
                            100: '#e0e7ff',
                            200: '#c7d2fe',
                            300: '#a5b4fc',
                            400: '#818cf8',
                            500: '#6366f1',
                            600: '#4f46e5',
                            700: '#4338ca',
                            800: '#3730a3',
                            900: '#312e81',
                        }
                    },
                    animation: {
                        'bounce-slow': 'bounce 2s infinite',
                        'pulse-slow': 'pulse 3s infinite',
                        'float': 'float 3s ease-in-out infinite',
                        'slide-up': 'slideUp 0.5s ease-out',
                        'scale-in': 'scaleIn 0.3s ease-out',
                        'confetti': 'confetti 5s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        scaleIn: {
                            '0%': { opacity: '0', transform: 'scale(0.9)' },
                            '100%': { opacity: '1', transform: 'scale(1)' },
                        },
                        confetti: {
                            '0%, 100%': { transform: 'translateY(0) rotate(0deg)' },
                            '50%': { transform: 'translateY(-20px) rotate(180deg)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
        }

        .option-btn {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .option-btn:hover:not(.selected):not(:disabled) {
            transform: translateX(8px);
            border-color: #6366f1;
            background-color: #eef2ff;
        }

        .option-btn.selected {
            background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
            color: white;
            border-color: transparent;
            transform: scale(1.02);
        }

        .option-btn.correct {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-color: transparent;
        }

        .option-btn.incorrect {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border-color: transparent;
        }

        .progress-bar {
            background: linear-gradient(90deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);
            background-size: 200% 100%;
            animation: gradient-shift 2s ease infinite;
        }

        @keyframes gradient-shift {

            0%,
            100% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }
        }

        .score-circle {
            background: conic-gradient(#6366f1 var(--score-percent), #e5e7eb 0deg);
        }

        .confetti-piece {
            position: fixed;
            width: 10px;
            height: 10px;
            border-radius: 2px;
            animation: fall linear forwards;
            pointer-events: none;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(720deg);
            }
        }

        .shine {
            position: relative;
            overflow: hidden;
        }

        .shine::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(to right,
                    transparent 0%,
                    rgba(255, 255, 255, 0.3) 50%,
                    transparent 100%);
            transform: rotate(45deg);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% {
                transform: translateX(-100%) rotate(45deg);
            }

            100% {
                transform: translateX(100%) rotate(45deg);
            }
        }
    </style>
</head>

<body class="min-h-screen bg-gradient-to-br from-slate-900 via-indigo-950 to-slate-900 font-inter">

    <!-- Decorative Background Elements -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="absolute top-20 left-10 w-72 h-72 bg-indigo-500/20 rounded-full blur-3xl animate-pulse-slow"></div>
        <div class="absolute bottom-20 right-10 w-96 h-96 bg-purple-500/20 rounded-full blur-3xl animate-pulse-slow"
            style="animation-delay: 1s;"></div>
        <div
            class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] bg-blue-500/10 rounded-full blur-3xl">
        </div>
    </div>

    <div class="relative z-10 container mx-auto px-4 py-8 max-w-2xl">

        <!-- Header -->
        <header class="text-center mb-8 animate-slide-up">
            <div class="inline-flex items-center gap-3 bg-white/10 backdrop-blur-lg px-6 py-3 rounded-full mb-4">
                <span class="text-3xl animate-bounce-slow">üìö</span>
                <span class="text-white font-bold text-lg">Ezteach</span>
            </div>
            <h1 class="text-3xl md:text-4xl font-extrabold text-white mb-2">
                Unit 7: <span
                    class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-purple-400">Traffic</span>
            </h1>
            <p class="text-indigo-200 text-sm md:text-base">Global Success 7 - B√†i ki·ªÉm tra tr·∫Øc nghi·ªám</p>
        </header>

        <!-- Start Screen -->
        <section id="startScreen" class="animate-scale-in">
            <div class="glass-card rounded-3xl shadow-2xl overflow-hidden">
                <div class="gradient-bg p-8 text-center">
                    <div class="inline-flex items-center justify-center w-20 h-20 bg-white/20 rounded-full mb-4">
                        <span class="text-4xl">üöó</span>
                    </div>
                    <h2 class="text-2xl font-bold text-white mb-2">S·∫µn s√†ng ki·ªÉm tra?</h2>
                    <p class="text-indigo-100">10 c√¢u h·ªèi ‚Ä¢ M·ª©c ƒë·ªô trung b√¨nh</p>
                </div>
                <div class="p-8">
                    <div class="grid grid-cols-3 gap-4 mb-8">
                        <div class="text-center p-4 bg-indigo-50 rounded-2xl">
                            <div class="text-2xl mb-1">üìù</div>
                            <div class="text-2xl font-bold text-indigo-600">10</div>
                            <div class="text-xs text-gray-500">C√¢u h·ªèi</div>
                        </div>
                        <div class="text-center p-4 bg-purple-50 rounded-2xl">
                            <div class="text-2xl mb-1">‚è±Ô∏è</div>
                            <div class="text-2xl font-bold text-purple-600">‚àû</div>
                            <div class="text-xs text-gray-500">Kh√¥ng gi·ªõi h·∫°n</div>
                        </div>
                        <div class="text-center p-4 bg-pink-50 rounded-2xl">
                            <div class="text-2xl mb-1">üéØ</div>
                            <div class="text-2xl font-bold text-pink-600">10</div>
                            <div class="text-xs text-gray-500">ƒêi·ªÉm t·ªëi ƒëa</div>
                        </div>
                    </div>

                    <form id="studentForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                <span class="mr-2">üë§</span>H·ªç v√† t√™n
                            </label>
                            <input type="text" id="studentName" required
                                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition-all outline-none text-gray-700"
                                placeholder="Nh·∫≠p h·ªç v√† t√™n c·ªßa b·∫°n...">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                <span class="mr-2">üè´</span>L·ªõp
                            </label>
                            <input type="text" id="studentClass" required
                                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition-all outline-none text-gray-700"
                                placeholder="V√≠ d·ª•: 7A1">
                        </div>
                        <button type="submit"
                            class="w-full py-4 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold text-lg rounded-xl shadow-lg hover:shadow-xl hover:scale-[1.02] active:scale-[0.98] transition-all duration-300 shine">
                            <span class="mr-2">üöÄ</span>B·∫Øt ƒë·∫ßu l√†m b√†i
                        </button>
                    </form>
                </div>
            </div>
        </section>

        <!-- Quiz Screen -->
        <section id="quizScreen" class="hidden">
            <!-- Progress Header -->
            <div class="glass-card rounded-2xl p-4 mb-6 shadow-lg animate-slide-up">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-500 rounded-full flex items-center justify-center text-white font-bold text-sm"
                            id="currentQuestionNum">1</div>
                        <div>
                            <div class="text-sm text-gray-500">C√¢u h·ªèi</div>
                            <div class="font-bold text-gray-800"><span id="currentQ">1</span> / <span
                                    id="totalQ">10</span></div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm text-gray-500" id="displayStudentName">H·ªçc sinh</div>
                        <div class="text-xs text-indigo-600 font-medium" id="displayStudentClass">L·ªõp 7</div>
                    </div>
                </div>
                <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
                    <div id="progressBar" class="h-full progress-bar rounded-full transition-all duration-500 ease-out"
                        style="width: 10%"></div>
                </div>
            </div>

            <!-- Question Card -->
            <div class="glass-card rounded-3xl shadow-2xl overflow-hidden animate-scale-in" id="questionCard">
                <div class="p-6 md:p-8">
                    <div class="flex items-start gap-4 mb-6">
                        <div
                            class="flex-shrink-0 w-12 h-12 bg-gradient-to-br from-indigo-500 to-purple-500 rounded-2xl flex items-center justify-center text-white font-bold text-lg shadow-lg">
                            <span id="qNumber">1</span>
                        </div>
                        <p id="questionText"
                            class="text-lg md:text-xl font-semibold text-gray-800 leading-relaxed pt-2">
                            Loading question...
                        </p>
                    </div>

                    <div id="optionsContainer" class="space-y-3">
                        <!-- Options will be inserted here -->
                    </div>
                </div>

                <div class="px-6 md:px-8 pb-6 md:pb-8">
                    <div class="flex gap-3">
                        <button id="prevBtn"
                            class="flex-1 py-3 px-6 bg-gray-100 text-gray-700 font-semibold rounded-xl hover:bg-gray-200 transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                            disabled>
                            ‚Üê Tr∆∞·ªõc
                        </button>
                        <button id="nextBtn"
                            class="flex-1 py-3 px-6 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold rounded-xl hover:shadow-lg hover:scale-[1.02] active:scale-[0.98] transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                            Ti·∫øp ‚Üí
                        </button>
                        <button id="submitBtn"
                            class="hidden flex-1 py-3 px-6 bg-gradient-to-r from-emerald-500 to-teal-500 text-white font-semibold rounded-xl hover:shadow-lg hover:scale-[1.02] active:scale-[0.98] transition-all">
                            ‚úì N·ªôp b√†i
                        </button>
                    </div>
                </div>
            </div>

            <!-- Question Navigator -->
            <div class="glass-card rounded-2xl p-4 mt-6 shadow-lg">
                <div class="text-sm text-gray-500 mb-3 font-medium">ƒêi·ªÅu h∆∞·ªõng c√¢u h·ªèi:</div>
                <div id="questionNav" class="flex flex-wrap gap-2">
                    <!-- Question navigation buttons will be inserted here -->
                </div>
            </div>
        </section>

        <!-- Result Screen -->
        <section id="resultScreen" class="hidden">
            <div class="glass-card rounded-3xl shadow-2xl overflow-hidden animate-scale-in">
                <div id="resultHeader" class="p-8 text-center">
                    <div class="relative inline-block mb-4">
                        <div class="w-32 h-32 rounded-full score-circle flex items-center justify-center"
                            style="--score-percent: 0deg;">
                            <div class="w-28 h-28 bg-white rounded-full flex flex-col items-center justify-center">
                                <span id="scoreDisplay" class="text-4xl font-extrabold text-indigo-600">0</span>
                                <span class="text-gray-400 text-sm">/10 ƒëi·ªÉm</span>
                            </div>
                        </div>
                    </div>
                    <h2 id="resultTitle" class="text-2xl font-bold text-white mb-2">K·∫øt qu·∫£</h2>
                    <p id="resultMessage" class="text-indigo-100">ƒêang t√≠nh ƒëi·ªÉm...</p>
                </div>

                <div class="p-8">
                    <div class="grid grid-cols-3 gap-4 mb-8">
                        <div class="text-center p-4 bg-emerald-50 rounded-2xl border-2 border-emerald-100">
                            <div class="text-2xl mb-1">‚úÖ</div>
                            <div id="correctCount" class="text-2xl font-bold text-emerald-600">0</div>
                            <div class="text-xs text-gray-500">C√¢u ƒë√∫ng</div>
                        </div>
                        <div class="text-center p-4 bg-red-50 rounded-2xl border-2 border-red-100">
                            <div class="text-2xl mb-1">‚ùå</div>
                            <div id="incorrectCount" class="text-2xl font-bold text-red-500">0</div>
                            <div class="text-xs text-gray-500">C√¢u sai</div>
                        </div>
                        <div class="text-center p-4 bg-indigo-50 rounded-2xl border-2 border-indigo-100">
                            <div class="text-2xl mb-1">üìä</div>
                            <div id="percentDisplay" class="text-2xl font-bold text-indigo-600">0%</div>
                            <div class="text-xs text-gray-500">T·ª∑ l·ªá</div>
                        </div>
                    </div>

                    <div class="flex gap-3">
                        <button id="reviewAnswersBtn"
                            class="flex-1 py-3 px-6 bg-gray-100 text-gray-700 font-semibold rounded-xl hover:bg-gray-200 transition-all">
                            üìã Xem ƒë√°p √°n
                        </button>
                        <button id="retryQuizBtn"
                            class="flex-1 py-3 px-6 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold rounded-xl hover:shadow-lg hover:scale-[1.02] active:scale-[0.98] transition-all">
                            üîÑ L√†m l·∫°i
                        </button>
                    </div>
                </div>
            </div>

            <!-- Review Section -->
            <div id="reviewSection" class="hidden mt-6 space-y-4 animate-slide-up">
                <h3 class="text-xl font-bold text-white text-center mb-4">üìù Chi ti·∫øt ƒë√°p √°n</h3>
                <div id="reviewContainer">
                    <!-- Review cards will be inserted here -->
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="text-center mt-8 text-indigo-300/60 text-sm">
            <p>¬© 2026 Ezteach - Th·∫ßy V√µ Ng·ªçc T√πng</p>
            <p class="mt-1">
                <a href="https://zalo.me/0914666040" class="hover:text-indigo-300 transition-colors">üí¨ Zalo</a>
                <span class="mx-2">‚Ä¢</span>
                <a href="https://facebook.com/vongoctungthcs" class="hover:text-indigo-300 transition-colors">üìò
                    Facebook</a>
            </p>
        </footer>
    </div>

    <script>
        // ===== Quiz Data from NotebookLM =====
        const quizData = [
            {
                id: 1,
                question: "Pedestrians should walk across the street at the __________.",
                options: ["traffic light", "zebra crossing", "speed limit", "seat belt"],
                correct: 1,
                explanation: '"Zebra crossing" l√† v·∫°ch k·∫ª cho ng∆∞·ªùi ƒëi b·ªô sang ƒë∆∞·ªùng.'
            },
            {
                id: 2,
                question: "You __________ drive too fast because it is dangerous.",
                options: ["should", "can", "shouldn't", "must"],
                correct: 2,
                explanation: 'D√πng "shouldn\'t" ƒë·ªÉ ƒë∆∞a ra l·ªùi khuy√™n kh√¥ng n√™n l√†m g√¨.'
            },
            {
                id: 3,
                question: "Drivers have to fasten their __________ whenever they drive a car.",
                options: ["seat belt", "handlebars", "roof", "pavement"],
                correct: 0,
                explanation: '"Seat belt" l√† d√¢y an to√†n, c·∫ßn th·∫Øt khi l√°i xe.'
            },
            {
                id: 4,
                question: "A __________ is a person who is walking on the street, not driving a vehicle.",
                options: ["passenger", "driver", "cyclist", "pedestrian"],
                correct: 3,
                explanation: '"Pedestrian" nghƒ©a l√† ng∆∞·ªùi ƒëi b·ªô.'
            },
            {
                id: 5,
                question: "We __________ obey traffic rules strictly to avoid accidents.",
                options: ["should", "shouldn't", "are", "used to"],
                correct: 0,
                explanation: 'D√πng "should" ƒë·ªÉ khuy√™n n√™n l√†m ƒëi·ªÅu ƒë√∫ng ƒë·∫Øn.'
            },
            {
                id: 6,
                question: 'When you see a "No Parking" sign, you __________ park your car there.',
                options: ["should", "shouldn't", "do", "are"],
                correct: 1,
                explanation: 'Bi·ªÉn b√°o "No Parking" (C·∫•m ƒë·ªó xe) ƒë·ªìng nghƒ©a v·ªõi vi·ªác b·∫°n kh√¥ng n√™n ƒë·ªó xe ·ªü ƒë√≥.'
            },
            {
                id: 7,
                question: "There are so many vehicles on the road during rush hour. It is a __________.",
                options: ["traffic jam", "road sign", "traffic rule", "railway"],
                correct: 0,
                explanation: '"Traffic jam" nghƒ©a l√† t·∫Øc ƒë∆∞·ªùng/k·∫πt xe.'
            },
            {
                id: 8,
                question: "You should __________ right and left when you go across the road.",
                options: ["to look", "looking", "look", "looks"],
                correct: 2,
                explanation: 'Sau ƒë·ªông t·ª´ khuy·∫øt thi·∫øu "should" l√† ƒë·ªông t·ª´ nguy√™n th·ªÉ (V-inf).'
            },
            {
                id: 9,
                question: "Cyclists must use the __________ to steer their bicycles.",
                options: ["roof", "handlebars", "signal", "lane"],
                correct: 1,
                explanation: '"Handlebars" l√† ghi-ƒë√¥ng/tay l√°i xe ƒë·∫°p.'
            },
            {
                id: 10,
                question: 'This road sign shows a red circle with a bicycle inside. It means "__________".',
                options: ["Cycle lane", "No cycling", "School ahead", "No parking"],
                correct: 1,
                explanation: 'Bi·ªÉn b√°o h√¨nh tr√≤n vi·ªÅn ƒë·ªè th∆∞·ªùng l√† bi·ªÉn c·∫•m. H√¨nh xe ƒë·∫°p b√™n trong bi·ªÉu th·ªã "No cycling".'
            }
        ];

        // ===== Google Sheets Integration =====
        // Thay URL n√†y b·∫±ng URL c·ªßa Google Apps Script c·ªßa b·∫°n
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzIV-2Sek6n8o6aSMc868rMzaxxTmPHrfJ_Qbgw7iXmnbzCSB3OF2zzrZJdmVsbu4buow/exec';

        // ===== State =====
        let state = {
            studentName: '',
            studentClass: '',
            currentQuestion: 0,
            answers: {},
            submitted: false
        };

        // ===== Send to Google Sheets =====
        async function sendToGoogleSheets(name, className, score) {
            if (GOOGLE_SCRIPT_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
                console.warn('Google Apps Script URL ch∆∞a ƒë∆∞·ª£c c·∫•u h√¨nh');
                showSubmitStatus('‚ö†Ô∏è Ch∆∞a k·∫øt n·ªëi Google Sheets', 'warning');
                return;
            }

            try {
                const data = {
                    name: name,
                    className: className,
                    score: score
                };

                await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                showSubmitStatus('‚úÖ ƒê√£ g·ª≠i k·∫øt qu·∫£ l√™n Google Sheets!', 'success');
            } catch (error) {
                console.error('L·ªói g·ª≠i d·ªØ li·ªáu:', error);
                showSubmitStatus('‚ùå Kh√¥ng th·ªÉ g·ª≠i k·∫øt qu·∫£', 'error');
            }
        }

        // ===== Show Submit Status =====
        function showSubmitStatus(message, type) {
            let statusDiv = document.getElementById('submitStatus');
            if (!statusDiv) {
                statusDiv = document.createElement('div');
                statusDiv.id = 'submitStatus';
                statusDiv.className = 'text-center mt-4 py-2 px-4 rounded-lg text-sm font-medium';
                document.querySelector('#resultScreen .p-8').appendChild(statusDiv);
            }

            statusDiv.textContent = message;
            statusDiv.classList.remove('bg-emerald-100', 'text-emerald-700', 'bg-red-100', 'text-red-700', 'bg-amber-100', 'text-amber-700');

            if (type === 'success') {
                statusDiv.classList.add('bg-emerald-100', 'text-emerald-700');
            } else if (type === 'error') {
                statusDiv.classList.add('bg-red-100', 'text-red-700');
            } else {
                statusDiv.classList.add('bg-amber-100', 'text-amber-700');
            }
        }

        // ===== DOM Elements =====
        const startScreen = document.getElementById('startScreen');
        const quizScreen = document.getElementById('quizScreen');
        const resultScreen = document.getElementById('resultScreen');
        const studentForm = document.getElementById('studentForm');

        // ===== Initialize =====
        document.addEventListener('DOMContentLoaded', () => {
            studentForm.addEventListener('submit', handleStart);
            document.getElementById('prevBtn').addEventListener('click', () => navigateQuestion(-1));
            document.getElementById('nextBtn').addEventListener('click', () => navigateQuestion(1));
            document.getElementById('submitBtn').addEventListener('click', handleSubmit);
            document.getElementById('reviewAnswersBtn').addEventListener('click', toggleReview);
            document.getElementById('retryQuizBtn').addEventListener('click', handleRetry);
        });

        // ===== Start Quiz =====
        function handleStart(e) {
            e.preventDefault();

            state.studentName = document.getElementById('studentName').value.trim();
            state.studentClass = document.getElementById('studentClass').value.trim();

            if (!state.studentName || !state.studentClass) {
                alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!');
                return;
            }

            document.getElementById('displayStudentName').textContent = state.studentName;
            document.getElementById('displayStudentClass').textContent = `L·ªõp ${state.studentClass}`;

            initQuestionNav();
            renderQuestion();

            startScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ===== Initialize Question Navigation =====
        function initQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';

            quizData.forEach((q, i) => {
                const btn = document.createElement('button');
                btn.className = 'w-10 h-10 rounded-xl font-semibold text-sm transition-all border-2 border-gray-200 bg-white text-gray-600 hover:border-indigo-400 hover:bg-indigo-50';
                btn.textContent = i + 1;
                btn.onclick = () => {
                    state.currentQuestion = i;
                    renderQuestion();
                };
                nav.appendChild(btn);
            });

            updateQuestionNav();
        }

        // ===== Update Question Navigation =====
        function updateQuestionNav() {
            const buttons = document.getElementById('questionNav').children;

            Array.from(buttons).forEach((btn, i) => {
                btn.classList.remove('bg-indigo-600', 'text-white', 'border-indigo-600', 'bg-emerald-500', 'border-emerald-500', 'bg-white', 'text-gray-600', 'border-gray-200');

                if (i === state.currentQuestion) {
                    btn.classList.add('bg-indigo-600', 'text-white', 'border-indigo-600');
                } else if (state.answers[i] !== undefined) {
                    btn.classList.add('bg-emerald-500', 'text-white', 'border-emerald-500');
                } else {
                    btn.classList.add('bg-white', 'text-gray-600', 'border-gray-200');
                }
            });
        }

        // ===== Render Question =====
        function renderQuestion() {
            const q = quizData[state.currentQuestion];
            const total = quizData.length;

            document.getElementById('currentQuestionNum').textContent = state.currentQuestion + 1;
            document.getElementById('currentQ').textContent = state.currentQuestion + 1;
            document.getElementById('totalQ').textContent = total;
            document.getElementById('qNumber').textContent = state.currentQuestion + 1;
            document.getElementById('questionText').textContent = q.question;

            // Progress bar
            const progress = ((state.currentQuestion + 1) / total) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;

            // Options
            const container = document.getElementById('optionsContainer');
            container.innerHTML = '';

            const letters = ['A', 'B', 'C', 'D'];

            q.options.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn w-full p-4 text-left rounded-xl border-2 border-gray-200 flex items-center gap-4 bg-white';

                if (state.answers[state.currentQuestion] === i) {
                    btn.classList.add('selected');
                }

                btn.innerHTML = `
                    <span class="flex-shrink-0 w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center font-bold text-gray-600">${letters[i]}</span>
                    <span class="font-medium text-gray-700">${opt}</span>
                `;

                btn.onclick = () => selectAnswer(i);
                container.appendChild(btn);
            });

            // Navigation buttons
            document.getElementById('prevBtn').disabled = state.currentQuestion === 0;

            const isLastQuestion = state.currentQuestion === total - 1;
            const allAnswered = Object.keys(state.answers).length === total;

            document.getElementById('nextBtn').classList.toggle('hidden', isLastQuestion);
            document.getElementById('submitBtn').classList.toggle('hidden', !isLastQuestion);

            updateQuestionNav();
        }

        // ===== Select Answer =====
        function selectAnswer(index) {
            if (state.submitted) return;

            state.answers[state.currentQuestion] = index;
            renderQuestion();
        }

        // ===== Navigate Question =====
        function navigateQuestion(direction) {
            const newIndex = state.currentQuestion + direction;
            if (newIndex >= 0 && newIndex < quizData.length) {
                state.currentQuestion = newIndex;
                renderQuestion();

                // Smooth scroll to card
                document.getElementById('questionCard').scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        // ===== Submit Quiz =====
        function handleSubmit() {
            const answered = Object.keys(state.answers).length;
            const total = quizData.length;

            if (answered < total) {
                const unanswered = total - answered;
                if (!confirm(`B·∫°n c√≤n ${unanswered} c√¢u ch∆∞a tr·∫£ l·ªùi. B·∫°n c√≥ ch·∫Øc mu·ªën n·ªôp b√†i?`)) {
                    return;
                }
            } else {
                if (!confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën n·ªôp b√†i?')) {
                    return;
                }
            }

            state.submitted = true;
            showResults();
        }

        // ===== Show Results =====
        function showResults() {
            let correct = 0;

            quizData.forEach((q, i) => {
                if (state.answers[i] === q.correct) {
                    correct++;
                }
            });

            const total = quizData.length;
            const incorrect = total - correct;
            const score = correct;
            const percent = Math.round((correct / total) * 100);

            // Update UI
            document.getElementById('scoreDisplay').textContent = score;
            document.getElementById('correctCount').textContent = correct;
            document.getElementById('incorrectCount').textContent = incorrect;
            document.getElementById('percentDisplay').textContent = `${percent}%`;

            // Score circle animation
            const circle = document.querySelector('.score-circle');
            const scorePercent = (correct / total) * 360;
            setTimeout(() => {
                circle.style.setProperty('--score-percent', `${scorePercent}deg`);
            }, 100);

            // Result message
            const header = document.getElementById('resultHeader');
            let title, message, gradient;

            if (score >= 9) {
                title = 'üèÜ Xu·∫•t s·∫Øc!';
                message = 'Tuy·ªát v·ªùi! B·∫°n ƒë√£ l√†m ch·ªß ki·∫øn th·ª©c Unit 7!';
                gradient = 'bg-gradient-to-br from-amber-400 to-orange-500';
                createConfetti();
            } else if (score >= 7) {
                title = 'üåü Gi·ªèi l·∫Øm!';
                message = 'K·∫øt qu·∫£ r·∫•t t·ªët! Ti·∫øp t·ª•c ph√°t huy nh√©!';
                gradient = 'bg-gradient-to-br from-emerald-400 to-teal-500';
            } else if (score >= 5) {
                title = 'üëç Kh√° t·ªët!';
                message = 'C·ªë g·∫Øng √¥n t·∫≠p th√™m ƒë·ªÉ ƒë·∫°t k·∫øt qu·∫£ cao h∆°n!';
                gradient = 'bg-gradient-to-br from-blue-400 to-indigo-500';
            } else {
                title = 'üí™ C·∫ßn c·ªë g·∫Øng!';
                message = 'ƒê·ª´ng n·∫£n l√≤ng! H√£y xem l·∫°i b√†i h·ªçc v√† th·ª≠ l·∫°i nh√©!';
                gradient = 'bg-gradient-to-br from-pink-400 to-rose-500';
            }

            document.getElementById('resultTitle').textContent = title;
            document.getElementById('resultMessage').textContent = message;
            header.className = `p-8 text-center ${gradient}`;

            // Show result screen
            quizScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');

            window.scrollTo({ top: 0, behavior: 'smooth' });

            // Send results to Google Sheets
            sendToGoogleSheets(state.studentName, state.studentClass, score);
        }

        // ===== Create Confetti =====
        function createConfetti() {
            const colors = ['#6366f1', '#8b5cf6', '#a855f7', '#ec4899', '#f43f5e', '#10b981', '#f59e0b'];

            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti-piece';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                    confetti.style.animationDelay = Math.random() * 0.5 + 's';
                    document.body.appendChild(confetti);

                    setTimeout(() => confetti.remove(), 5000);
                }, i * 50);
            }
        }

        // ===== Toggle Review =====
        function toggleReview() {
            const reviewSection = document.getElementById('reviewSection');
            const btn = document.getElementById('reviewAnswersBtn');

            if (reviewSection.classList.contains('hidden')) {
                generateReview();
                reviewSection.classList.remove('hidden');
                btn.innerHTML = 'üîº ·∫®n ƒë√°p √°n';
                reviewSection.scrollIntoView({ behavior: 'smooth' });
            } else {
                reviewSection.classList.add('hidden');
                btn.innerHTML = 'üìã Xem ƒë√°p √°n';
            }
        }

        // ===== Generate Review =====
        function generateReview() {
            const container = document.getElementById('reviewContainer');
            container.innerHTML = '';

            const letters = ['A', 'B', 'C', 'D'];

            quizData.forEach((q, i) => {
                const userAnswer = state.answers[i];
                const isCorrect = userAnswer === q.correct;

                const card = document.createElement('div');
                card.className = 'glass-card rounded-2xl overflow-hidden shadow-lg';

                card.innerHTML = `
                    <div class="p-4 ${isCorrect ? 'bg-emerald-500' : 'bg-red-500'} flex items-center gap-3">
                        <span class="text-2xl">${isCorrect ? '‚úÖ' : '‚ùå'}</span>
                        <span class="text-white font-bold">C√¢u ${i + 1}</span>
                        <span class="ml-auto text-white/80 text-sm">${isCorrect ? 'ƒê√∫ng' : 'Sai'}</span>
                    </div>
                    <div class="p-4">
                        <p class="font-semibold text-gray-800 mb-4">${q.question}</p>
                        <div class="space-y-2">
                            ${q.options.map((opt, idx) => {
                    let classes = 'p-3 rounded-lg flex items-center gap-3 ';

                    if (idx === q.correct) {
                        classes += 'bg-emerald-100 border-2 border-emerald-500';
                    } else if (idx === userAnswer && !isCorrect) {
                        classes += 'bg-red-100 border-2 border-red-500';
                    } else {
                        classes += 'bg-gray-50';
                    }

                    return `
                                    <div class="${classes}">
                                        <span class="w-8 h-8 rounded-lg ${idx === q.correct ? 'bg-emerald-500 text-white' : idx === userAnswer && !isCorrect ? 'bg-red-500 text-white' : 'bg-gray-200 text-gray-600'} flex items-center justify-center font-bold text-sm">${letters[idx]}</span>
                                        <span class="${idx === q.correct ? 'font-semibold text-emerald-700' : idx === userAnswer && !isCorrect ? 'text-red-700' : 'text-gray-600'}">${opt}</span>
                                        ${idx === q.correct ? '<span class="ml-auto text-emerald-600">‚úì ƒê√°p √°n ƒë√∫ng</span>' : ''}
                                        ${idx === userAnswer && !isCorrect ? '<span class="ml-auto text-red-600">‚úó B·∫°n ch·ªçn</span>' : ''}
                                    </div>
                                `;
                }).join('')}
                        </div>
                        <div class="mt-4 p-3 bg-indigo-50 rounded-lg border border-indigo-200">
                            <span class="text-indigo-600 font-semibold">üí° Gi·∫£i th√≠ch:</span>
                            <span class="text-gray-700 ml-2">${q.explanation}</span>
                        </div>
                    </div>
                `;

                container.appendChild(card);
            });
        }

        // ===== Retry Quiz =====
        function handleRetry() {
            state = {
                studentName: '',
                studentClass: '',
                currentQuestion: 0,
                answers: {},
                submitted: false
            };

            document.getElementById('studentForm').reset();
            document.getElementById('reviewSection').classList.add('hidden');
            document.getElementById('reviewAnswersBtn').innerHTML = 'üìã Xem ƒë√°p √°n';

            resultScreen.classList.add('hidden');
            startScreen.classList.remove('hidden');

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>

</html>